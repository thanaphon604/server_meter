<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css">
    <title>ระบบบันทึกหน่วยไฟฟ้าอัจฉริยะ</title>
    <link rel="stylesheet" href="">
    <style>
        #Head {
    font-size: 20px;
    background-color: #FFA500;
    color: black;
    border: 2px
  }
  div.bigroom{
    width: 100px;
    height: 150px;
    margin-left: 5%
  }
  
  .TextHead{
    font-size: 50px
    
  }body{
         background-color:rgb(236, 236, 236)
  }
  .room{
     
     border: 2px solid black;
    width: 100px;
    height: 90px;
  }
  }.roomgreen{
     background-color: green
     border: 2px solid black;
    width: 100px;
    height: 90px;
  }
  .roomorange{
     background-color: orange
     border: 2px solid black;
    width: 100px;
    height: 90px;
  }
  .roomgrey{
     background-color: grey
     border: 2px solid black;
    width: 100px;
    height: 90px;
  }.divform{
    width: 100%;
    padding: 12px 20px;
    margin: 8px 0;
    display: inline-block;
    border: 1px solid #ccc;
    border-radius: 4px;
    box-sizing: border-box;
    background-color:whitesmoke;

  }#singlebutton{
    width:100%;
    margin-left: 0%  
  
  }
    </style>
</head>

<body>
    <div class="container-fluid" id="Head">
        <div class="class col-sm-12 ">
            <div class="row justify-content-center">
                <ul>
                    <img src="https://www.bpicc.com/images/2018/10/09/Logo_Intregrate.png" width="90px" height="90px"
                        alt="">
                </ul>
                <ul>
                    <img src="https://www.bpicc.com/images/2018/10/09/lg_wu.png" width="80px" height="90px" alt="">
                </ul>
                <div>
                    <ul>
                        <h1>ระบบบันทึกหน่วยไฟฟ้าอัจฉริยะ </h1>
                    </ul>
                    <ul>
                        <h5>(Smart energy monitoring system)</h2>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <!--
  Extra small <576px   col
  small > 576      px  col-sm
  mediu, >= 768        col-md
  Large >=992 px       com-lg
  Extra Large >= 120px col-xl
-->
    <nav class="navbar navbar-expand-lg navbar-light bg-light navbar navbar-dark bg-dark">
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarTogglerDemo02"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarTogglerDemo02">
            <ul class="nav nav-pills mb-3" id="pills-tab" role="tablist">
                <li class="nav-item">
                    <a class="nav-link active" id="pills-home-tab" data-toggle="pill" href="#pills-home" role="tab"
                        aria-controls="pills-home" aria-selected="true">ผังห้อง</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="pills-profile-tab" data-toggle="pill" href="#pills-profile" role="tab"
                        aria-controls="pills-profile" aria-selected="false">ผู้เช่า</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="pills-contact-tab1" data-toggle="pill" href="#pills-contact1" role="tab"
                        aria-controls="pills-contact" aria-selected="false">จดมิเตอร์</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="pills-contact-tab2" data-toggle="pill" href="#pills-contact2" role="tab"
                        aria-controls="pills-contact" aria-selected="false">วิเคราะห์การใช้พลังงาน</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="pills-contact-tab3" data-toggle="pill" href="#pills-contact3" role="tab"
                        aria-controls="pills-contact" aria-selected="false">ออกใบเเจ้งหนี้&ใบเสร็จ</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="pills-contact-tab4" data-toggle="pill" href="#pills-contact4" role="tab"
                        aria-controls="pills-contact" aria-selected="false">จัดการหอพัก</a>
                </li>
            </ul>

            <form class="form-inline my-2 my-lg-0 fixed-right">
                <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Log out</button>
            </form>
        </div>
    </nav>
    <div class="tab-content" id="pills-tabContent">
        <!-- ผังห้อง -->
        <div class="tab-pane fade show active" id="pills-home" role="tabpanel" aria-labelledby="pills-home-tab">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-12 order-2 order-sm-2 order-md-2 order-lg-2 col-lg-6  col-xl-7 order-xl-1 ">
                        <div>
                            <div class="" id="divPostHome" style="margin-top:5%">
                            </div>
                        </div>
                        <div id="divPosthr"></div>
                    </div>


                    <div class="col-12 order-1 col-lg-6 order-md-1 order-sm-1 order-lg-1 col-xl-5 " style="margin-top: 15%">
                        <div class="row">
                            <table class="table table-bordered">
                                <thead>
                                    <tr>
                                        <th scope="col" style="background-color: green ; height: 50px;">ห้องว่าง</th>
                                        <th scope="col" style="background-color: orange">ห้องไม่ว่าง</th>
                                        <th scope="col" style="background-color: grey">กำลังปรับปรุง</th>
                                    </tr>
                                </thead>
                                <tbody>

                                    <tr>
                                        <th scope="row">10</th>
                                        <td scope="row"> 30</td>
                                        <td scope="row">1</td>
                                    </tr>

                                </tbody>
                            </table>
                        </div>
                    </div>

                </div>

            </div>

        </div>


        <!-- ผู้เช่า -->
        <div class="tab-pane fade" id="pills-profile" role="tabpanel" aria-labelledby="pills-profile-tab">
            <nav>
                <div class="nav nav-tabs" id="nav-tab" role="tablist">
                    <a class="nav-item nav-link active" id="nav-home-tab" data-toggle="tab" href="#nav-home" role="tab"
                        aria-controls="nav-home" aria-selected="true">ผู้เช่าใหม่</a>
                    <a class="nav-item nav-link" id="nav-profile-tab" data-toggle="tab" href="#nav-profile" role="tab"
                        aria-controls="nav-profile" aria-selected="false">ผู้เช่าเก่า</a>

                </div>
            </nav>
            <div class="tab-content" id="nav-tabContent">
                <!--ผู้เช่าปัจจุบัน -->
                <div class="tab-pane fade show active" id="nav-home" role="tabpanel" aria-labelledby="nav-home-tab">
                    <div class="container-fluid" style="margin-top: 30px">
                        <div class="row justify-content-center">
                            <div class="col-lg-7 col-sm-12  ">
                                <br>
                                <table border="2" width="100%" class="table-responsive table table-striped">
                                    <thead class="thead-dark">
                                        <tr>
                                            <th scope="col">ลำดับที่</th>
                                            <th scope="col">ชื่อหอพัก</th>
                                            <th scope="col">เลขห้องพัก</th>
                                            <th scope="col">บัตรประชาชน</th>
                                            <th scope="col">ชื่อ</th>
                                            <th scope="col">นามสกุล</th>
                                            <th scope="col">วันเดือนปีเกิด</th>
                                            <th scope="col">ที่อยู่</th>
                                            <th scope="col">เบอร์โทรศัพท์</th>
                                            <th scope="col">ป้ายทะเบียนยานพาหนะ</th>
                                        </tr>
                                    </thead>
                                    <tbody id="tablePost">

                                    </tbody>
                                </table>




                            </div>

                        </div>
                    </div>
                </div>
                <div class="tab-pane fade" id="nav-profile" role="tabpanel" aria-labelledby="nav-profile-tab">
                    <div class="container-fluid" style="margin-top: 30px">
                        <div class="row justify-content-center">
                            <div class="col-lg-7 col-sm-12  ">
                                <br>
                                <table border="2" width="100%" class="table-responsive table table-striped">
                                    <thead class="thead-dark">
                                        <tr>
                                            <th scope="col">ลำดับที่</th>
                                            <th scope="col">ชื่อหอพัก</th>
                                            <th scope="col">เลขห้องพัก</th>
                                            <th scope="col">บัตรประชาชน</th>
                                            <th scope="col">ชื่อ</th>
                                            <th scope="col">นามสกุล</th>
                                            <th scope="col">วันเดือนปีเกิด</th>
                                            <th scope="col">ที่อยู่</th>
                                            <th scope="col">เบอร์โทรศัพท์</th>
                                            <th scope="col">ป้ายทะเบียนยานพาหนะ</th>
                                        </tr>
                                    </thead>
                                    <tbody id="tablePostUserdelete">

                                    </tbody>
                                </table>




                            </div>

                        </div>
                    </div>
                </div>

            </div>
        </div>
        <!--จดมิเตอร์ -->
        <div class="tab-pane fade" id="pills-contact1" role="tabpanel" aria-labelledby="pills-contact-tab1">
            <nav>
                <div class="nav nav-tabs" id="nav-tab" role="tablist">
                    <a class="nav-item nav-link active" id="nav-home-tab" data-toggle="tab" href="#nav-saveunit1" role="tab"
                        aria-controls="nav-home" aria-selected="true">บันทึกค่าไฟฟ้าเเต่ละห้อง</a>
                    <a class="nav-item nav-link" id="nav-profile-tab" data-toggle="tab" href="#nav-saveunit2" role="tab"
                        aria-controls="nav-profile" aria-selected="false">บันทึกค่าไฟฟ้าประจำเดือนของหอพัก</a>

                </div>
            </nav>
            <div class="tab-content" id="nav-tabContent">
                <div class="tab-pane fade show active" id="nav-saveunit1" role="tabpanel" aria-labelledby="nav-home-tab">

                </div>
                <div class="tab-pane fade" id="nav-saveunit2" role="tabpanel" aria-labelledby="nav-profile-tab">


                </div>

            </div>
        </div>
        <!-- วิเคราะห์การใช้พลังงาน  -->
        <div class="tab-pane fade" id="pills-contact2" role="tabpanel" aria-labelledby="pills-contact-tab2">

        </div>
        <!-- ออกใบเเจ้งหนี้ใบเสร็จ -->
        <div class="tab-pane fade" id="pills-contact3" role="tabpanel" aria-labelledby="pills-contact-tab3">
            <nav>
                <div class="nav nav-tabs" id="nav-tab" role="tablist">
                    <a class="nav-item nav-link active" id="nav-home-tab" data-toggle="tab" href="#nav-invoice" role="tab"
                        aria-controls="nav-home" aria-selected="true">ใบเเจ้งหนี้</a>
                    <a class="nav-item nav-link" id="nav-profile-tab" data-toggle="tab" href="#nav-bill" role="tab"
                        aria-controls="nav-profile" aria-selected="false">ใบเสร็จ</a>

                </div>
            </nav>
            <div class="tab-content" id="nav-tabContent">
                <div class="tab-pane fade show active" id="nav-invoicec" role="tabpanel" aria-labelledby="nav-home-tab">...</div>
                <div class="tab-pane fade" id="nav-bill" role="tabpanel" aria-labelledby="nav-profile-tab">...</div>

            </div>
        </div>
        <!-- จัดการหอพัก -->
        <div class="tab-pane fade" id="pills-contact4" role="tabpanel" aria-labelledby="pills-contact-tab4">
            <nav>
                <div class="nav nav-tabs" id="nav-tab" role="tablist">
                    <a class="nav-item nav-link active" id="nav-home-tab" data-toggle="tab" href="#nav-unit" role="tab"
                        aria-controls="nav-home" aria-selected="true">หน่วยมิเตอร์</a>
                    <a class="nav-item nav-link" id="nav-profile-tab" data-toggle="tab" href="#nav-update" role="tab"
                        aria-controls="nav-profile" aria-selected="false">อัพเดทผังห้อง</a>
                    <a class="nav-item nav-link" id="nav-contact-tab" data-toggle="tab" href="#nav-set" role="tab"
                        aria-controls="nav-contact" aria-selected="false">เเจ้งปรับปรุง</a>
                    <a class="nav-item nav-link" id="nav-contact-tab" data-toggle="tab" href="#nav-setbuild" role="tab"
                        aria-controls="nav-contact" aria-selected="false">เเก้ไขข้อมูลหอพัก</a>
                </div>
            </nav>
            <div class="tab-content" id="nav-tabContent">
                <div class="tab-pane fade show active" id="nav-unit" role="tabpanel" aria-labelledby="nav-home-tab">
                    <div class="container">
                        <div class="row justify-content-center">
                            <div class="col-md-12 col-lg-8 ">
                                <br>
                                <br>
                                <br>
                                <form>
                                    <div class="row justify-content-center">
                                        <div class="col-4">
                                            <p class="h4">ค่าไฟฟ้าปัจจุบันหน่วยละ</p>
                                        </div>
                                        <div class="col-1">
                                            <p id="meter"></p>
                                        </div>
                                        <div class="col-3">
                                            <ul>
                                                <p class="h4"> บาท</p>
                                            </ul>
                                        </div>
                                    </div>
                                </form>
                                <br>
                                <br>
                                <br>
                                <div class="divform col-md-12 col-lg-12 ">
                                    <form action="" onsubmit="" method="">
                                        <div class="form-group">
                                            <label for="exampleInputEmail1">อัพเดทค่าไฟ้าต่อหน่วย</label>
                                            <input required name="UnitMeter" type="number" class="form-control" id="UnitMeter"
                                                placeholder="" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="exampleInputPassword1">บาท/หน่วย</label>

                                        </div>
                                        <hr>
                                        <button id="me" type="button" class="btn btn-primary">ยืนยัน</button>
                                        <!-- <button type="button" onclick="SubMit()" class="btn btn-primary">Submit</button> -->
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="tab-pane fade" id="nav-update" role="tabpanel" aria-labelledby="nav-profile-tab">...</div>
            <div class="tab-pane fade" id="nav-set" role="tabpanel" aria-labelledby="nav-contact-tab">...</div>
            <div class="tab-pane fade" id="nav-setbuild" role="tabpanel" aria-labelledby="nav-contact-tab">...</div>
        </div>

    </div>

    </div>


    <script src="https://code.jquery.com/jquery-3.3.1.js" integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
        crossorigin="anonymous"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>

    <script>


        $(document).ready(function () {

            //script หน้าผังห้อง
            var url_string = window.location.href
            var url = new URL(url_string);
            var BuildingName = url.searchParams.get("BuildingName");
            console.log(BuildingName)
            var htmlString1 = '';
            var htmlString = ''
            var htmlStringUserdelete = ''

            //sear data building 
            var ourRequest = new XMLHttpRequest();
            ourRequest.open('GET', 'http://localhost:3000/getbuild/' + BuildingName)
            ourRequest.onload = function () {
                var ourData = JSON.parse(ourRequest.responseText);
                console.log(ourData)
                renderHome(ourData);
                renderUser(ourData)
                return false;
            }
            ourRequest.send();
            Userdelete()
            //ดึงข้อมูล user delete

            /*
                        $(document).on('submit', '#formmeter', function () {
            
                            var meter = document.getElementById("inputmeter").value;
                            console.log(meter)
                            alert('ttt')
                            return false;
                        })
            */
            $('#me').click(function () {
                if (document.getElementById('UnitMeter').value == "") {
                    alert('Please Input Unitmeter');
                    return false;
                }
                var UnitMeter = document.getElementById("UnitMeter").value;
                var dataUnit = {
                    UnitMeter, BuildingName,
                }
                var url = "http://localhost:3000/postUUnitmeter";
                var xhr = new XMLHttpRequest();
                xhr.open("POST", url, true);
                xhr.setRequestHeader("Content-Type", "application/json");
                xhr.onreadystatechange = function () {
                    if (xhr.readyState === 4 && xhr.status === 200) {
                        console.log('res is', xhr.responseText)
                        // if success go login page
                        alert('create user Successful ')
                        window.location.reload(true);
                        //  window.location.href = 'http://127.0.0.1:5500/somelogin.html';

                    } else {
                        //alert('can not create user! Pls try again.')
                    }
                };
                var data = JSON.stringify({
                   UnitMeter: dataUnit.UnitMeter,BuildingName:dataUnit.BuildingName
                });
                xhr.send(data);


            })
            function renderHome(ourData) {
                //         console.log(ourData[0].floor[0].room.length)
                for (let i = 0; i < ourData[0].floor.length; i++) {
                    htmlString1 += '<br><p>ชั้น' + (i + 1) + '</p><hr style="border: 1px solid black;"<br><div class="row" >'
                    for (let j = 0; j < ourData[0].floor[i].room.length; j++) {
                        let p = 3

                        htmlString1 += '<div class="bigroom"><div> <a href="http://localhost:3000/Person?BuildingName=' + BuildingName + '&room=' + ourData[0].floor[i].room[j].contract + '&roomNumber=' + ourData[0].floor[i].room[j].roomNumber + '" >' + ourData[0].floor[i].room[j].roomNumber + '</a> </div><div id="changcss" class="room">  <br>  <p>15230.5kw/h</p></div></div> '
                        console.log('t', ourData[0].floor[i].room[j])
                        console.log('#')


                        //   htmlString3 = htmlString1 + htmlString2
                        // console.log('ห้อง',j)
                        //  console.log('ชั้น',i)
                        console.log('p', ourData[0].floor[i].room[j].contract)
                    }
                    htmlString1 += '</div>'
                }
                document.getElementById("divPostHome").innerHTML = htmlString1;
                document.getElementById("meter").innerHTML = ourData[0].UnitMeter




            }

            // กรอกข้อมูลของ user
            function FunctionUser(user) {

                alert('success')
            }
            /* function css() {
                 $("changcss").classList.add('roomgrey')
                 document.body.classList.add('article');
                 alert('success')
             } */
            //--------------------------------------------------------------------------------------------------
            //หน้า 2 ผู้เช่าเก่า ผู้เช่าใหม่
            function renderUser(ourData) {
                let l = 1
                for (let i = 0; i < ourData[0].floor.length; i++) {
                    for (let j = 0; j < ourData[0].floor[i].room.length; j++) {

                        for (let k = 0; k < ourData[0].floor[i].room[j].user.length; k++) {
                            htmlString += '<tr><th scope="row">' + (l++) + '</th><td>' + ourData[0].BuildingName + '</th><td>' + ourData[0].floor[i].room[j].roomNumber + '</th><td>' + ourData[0].floor[i].room[j].user[k].personID + '</td><td>'
                                + ourData[0].floor[i].room[j].user[k].firstName + '</td><td>' + ourData[0].floor[i].room[j].user[k].lastName + '</td><td>' + ourData[0].floor[i].room[j].user[k].birthday + '</td><td>' + ourData[0].floor[i].room[j].user[k].address + '</td><td>' + ourData[0].floor[i].room[j].user[k].phoneNumber + '</td><td>' + ourData[0].floor[i].room[j].user[k].License + '</td><td>'

                        }


                    }
                }
                tablePost.insertAdjacentHTML('beforeend', htmlString);
            }
            function Userdelete() {

                var ourRequest = new XMLHttpRequest();
                ourRequest.open('GET', 'http://localhost:3000/getUserdelete')
                ourRequest.onload = function () {
                    var ourData = JSON.parse(ourRequest.responseText);
                    console.log(ourData)
                    console.log('sdsdsdsdsds')
                    let l = 1
                    for (let i = 0; i < ourData.length; i++) {
                        htmlStringUserdelete += '<tr><th scope="row">' + (l++) + '</th><td>' + ourData[i].BuildingNameAllow + '</th><td>' + ourData[i].roomNumberAllow + '</th><td>' + ourData[i].personIDAllow + '</td><td>'
                            + ourData[i].firstNameAllow + '</td><td>' + ourData[i].lastNameAllow + '</td><td>' + ourData[i].birthdayAllow + '</td><td>' + ourData[i].ad + '</td><td>' + ourData[i].phoneNumberAllow + '</td><td>' + ourData[i].Li + '</td><td>'
                    }
                    tablePostUserdelete.insertAdjacentHTML('beforeend', htmlStringUserdelete);

                }
                ourRequest.send();

            }




        });


    </script>



    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"></script>
</body>

</html>