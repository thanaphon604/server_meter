<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css">
    <title>ระบบบันทึกหน่วยไฟฟ้าอัจฉริยะ</title>
    <link rel="stylesheet">
    <style>
        #Head {
    font-size: 20px;
    background-color:#FFA500;
    color: black;
    border: 2px
  }
  div.bigroom{
    width: 100px;
    height: 150px;
    margin-left: 5%
  }
  .ui-datepicker{
    width:150px;
    font-family:tahoma;
    font-size:11px;
    text-align:center;
}
  div.room{
    border: 2px solid black;
    width: 100px;
    height: 90px;
  }
  .TextHead{
    font-size: 50px
    
  }.divform{
    width: 100%;
    padding: 12px 20px;
    margin: 8px 0;
    display: inline-block;
    border: 1px solid #ccc;
    border-radius: 4px;
    box-sizing: border-box;
    background-color:whitesmoke;

  }body{
         background-color:rgb(236, 236, 236)
  }
   #img_container{
        
        height: 25px;
        width: 50px;
        display: table-cell;
        vertical-align: middle;
      }
      #img_container img{
       
        margin: auto auto;
        display: block;
      }
 
 

    </style>
</head>

<body>
    <div class="container-fluid" id="Head">
        <div class="class col-sm-12 ">
            <div class="row justify-content-center">
                <ul>
                    <img src="https://www.bpicc.com/images/2018/10/09/Logo_Intregrate.png" width="90px" height="90px"
                        alt="">
                </ul>
                <ul>
                    <img src="https://www.bpicc.com/images/2018/10/09/lg_wu.png" width="80px" height="90px" alt="">
                </ul>
                <div>
                    <ul>
                        <h1>ระบบบันทึกหน่วยไฟฟ้าอัจฉริยะ </h1>
                    </ul>
                    <ul>
                        <h5>(Smart energy monitoring system)</h2>
                    </ul>
                </div>
            </div>
        </div>
    </div>


    <!--
  Extra small <576px   col
  small > 576      px  col-sm
  mediu, >= 768        col-md
  Large >=992 px       com-lg
  Extra Large >= 120px col-xl
-->


    <nav>
        <div class="nav nav-tabs" id="nav-tab" role="tablist">
            <a class="nav-item nav-link active" id="nav-home-tab" data-toggle="tab" href="#nav-home" role="tab"
                aria-controls="nav-home" aria-selected="true">ข้อมูลห้อง</a>
            <a class="nav-item nav-link" id="nav-profile-tab" data-toggle="tab" href="#nav-profile" role="tab"
                aria-controls="nav-profile" aria-selected="false">ย้ายออก</a>

        </div>
    </nav>
    <div class="tab-content" id="nav-tabContent">

        <div class="tab-pane fade show active" id="nav-home" role="tabpanel" aria-labelledby="nav-home-tab">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-12 col-lg-5">
                        <br>
                        <hr>
                        <div class="divform">
                            <form name="form" id="form" action="" method="">
                                <p style="color:red">*กรุณากรอกข้อมูลให้ครบทั้ง2ช่อง</p>
                                <p style="color:red">*กรอกข้อมูลเฉพาะครั้งเเรกเท่านั้น </p>
                                <div class="form-group row">
                                    <label class="col-sm-2 col-form-label">วันที่ทำสัญญา</label>
                                    <div class="col-sm-10">

                                        <input type="date" class="form-control" name="contract" id="contract"
                                            placeholder="ที่อยุ่" required>
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label class="col-sm-2 col-form-label">ค่าเช่าห้อง</label>
                                    <div class="col-sm-10">
                                        <input type="number" oninput="javascript: if (this.value.length > this.maxLength) this.value = this.value.slice(0, this.maxLength);"
                                            maxlength="6" min="1" class="form-control" id="rentroom" placeholder="ค่าเช่าห้อง"
                                            required>
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <div class="col-sm-10">
                                        <button type="submit" class="btn btn-primary">บันทึก</button>
                                    </div>
                                </div>

                            </form>
                        </div>
                        <div class="divform">
                            <form name="form1" id="form1" action="" method="">
                                <p style="color:red">*กรุณากรอกข้อมูลให้ครบทุกช่อง</p>
                                <p id="plus">เพิ่มข้อมูล</p>
                                <div class="form-group row">
                                    <label class="col-sm-2 col-form-label">เลขบัตรประจำตัวประชาชน</label>
                                    <div class="col-sm-10">
                                        <input type="number" maxlength="13" class="form-control" id="personID" oninput="javascript: if (this.value.length > this.maxLength) this.value = this.value.slice(0, this.maxLength);"
                                            type="number" placeholder="เลขบัตรประจำตัวประชาชน">
                                        <div id="validationText"></div>
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label class="col-sm-2 col-form-label">ชื่อ</label>
                                    <div class="col-sm-10">
                                        <input type="text" maxlength="20" class="form-control" id="firstName"
                                            placeholder="ชื่อ">
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label class="col-sm-2 col-form-label">นามสกุล</label>
                                    <div class="col-sm-10">
                                        <input type="text" maxlength="20" class="form-control" id="lastName"
                                            placeholder="นามสกุล">
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label class="col-sm-2 col-form-label">วันเดือนปีเกิด</label>
                                    <div class="col-sm-10">
                                        <input type="date" class="form-control" id="birthday" placeholder="วันเดือนปีเกิด">
                                    </div>
                                </div>

                                {{!-- <fieldset class="form-group">
                                    <div class="row">
                                        <legend class="col-form-label col-sm-2 pt-0">เพศ</legend>
                                        <div class="col-sm-10">
                                            <div class="form-check">
                                                <input class="form-check-input" type="radio" name="radio" id="radio1"
                                                    value="">
                                                <label class="form-check-label" for="radio">
                                                    ชาย
                                                </label>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input" type="radio" name="radio" id="radio2"
                                                    value="">
                                                <label class="form-check-label" for="radio">
                                                    หญิง
                                                </label>
                                            </div>

                                        </div>
                                    </div>
                                </fieldset> --}}
                                <div class="form-group row">
                                    <label class="col-sm-2 col-form-label">ที่อยู่</label>
                                    <div class="col-sm-10">
                                        <input type="text" class="form-control" id="address" placeholder="ที่อยู่">
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label class="col-sm-2 col-form-label">หมายเลขโทรศัพท์</label>
                                    <div class="col-sm-10">
                                        <input oninput="javascript: if (this.value.length > this.maxLength) this.value = this.value.slice(0, this.maxLength);"
                                            type="number" maxlength="10" class="form-control" id="phoneNumber"
                                            placeholder="หมายเลขโทรศัพท์">
                                    </div>
                                    <div id="validationTextphone"></div>
                                </div>
                                <div class="form-group row">
                                    <label class="col-sm-2 col-form-label">ป้ายทะเบียนยานพาหนะ</label>
                                    <div class="col-sm-10">
                                        <input type="text" maxlength="15" class="form-control" id="License" placeholder="ป้ายทะเบียนยานพาหนะ">
                                    </div>
                                </div>

                                <div class="form-group row">
                                    <div class="col-sm-10">
                                        <button type="submit" class="btn btn-primary">บันทึก</button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                    <div class="col-lg-6 col-sm-5" style="margin-left: 3%">
                        <ul>
                            <p class="h2">ข้อมูลห้อง</p>
                        </ul>
                        <br>

                        <form>
                            <div class="row">
                                <div class="col-3">
                                    <p class="h4">หมายเลขห้อง</p>
                                </div>
                                <div class="col-3">
                                    <p id="nameR"></p>
                                </div>

                                <div class="col-3">
                                    <p class="h4">อาคาร</p>
                                </div>
                                <div class="col-3">
                                    <p id="nameB"></p>
                                </div>
                            </div>
                            <br>
                            <div class="row">


                                <div class="col-3">
                                    <p class="h4">วันที่ทำสัญญา</p>
                                </div>
                                <div class="col-3">
                                    <p id="showcontract"></p>
                                </div>
                                <div class="col-3">
                                    <p class="h4">ค่าเช่าห้อง</p>
                                </div>
                                <div class="col-3">
                                    <p id="showrentroom"></p>
                                </div>
                            </div>
                            <br>
                            <div class="row">

                            </div>
                        </form>
                        <br>
                        <br>
                        <div class="">
                            <table border="2" width="100%" class=" table-responsive no-padding  table table-striped">
                                <thead class="thead-dark">
                                    <tr>

                                        <th scope="col">ลำดับที่</th>
                                        <th scope="col">บัตรประชาชน</th>
                                        <th scope="col">ชื่อ</th>
                                        <th scope="col">นามสกุล</th>
                                        <th scope="col">ที่อยู่</th>
                                        <th scope="col">เบอร์โทรศัพท์</th>
                                        <th scope="col">ป้ายทะเบียนยานพาหนะ</th>
                                        <th scope="col">เเก้ไขข้อมูล</th>
                                        <th scope="col">ลบข้อมูล</th>
                                    </tr>
                                </thead>
                                <tbody id="tablePos">

                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

            </div>
        </div>

        <div class="tab-pane fade" id="nav-profile" role="tabpanel" aria-labelledby="nav-profile-tab">
            <div class="row justify-content-center">
                <div class="col-md-12 col-lg-8">
                    <p class="h1" style="text-align: center;">ย้ายออกหอพัก</p>
                    <div class="row divform">
                        <div class="col ">
                            <p class="h5" style="text-align: center;">บิลที่ค้างชำระ</p>
                            <br>
                            <label for="exampleInputEmail1" style="color: red">
                                <h5>*กรุณากลับไปหน้าออกใบเเจ้งหน้้&ใบเสร็จในกรณีมียอดค้างชำระเพื่อชำระเงินให้เรียบร้อยก่อนออกจากหอพัก</h5>
                            </label>
                            <div class="" id="bill" style="margin-top:5%">
                            </div>
                        </div>

                    </div>
                    <div class="row divform">
                        <p class="h5" style="text-align: center;">กรอกเลขมิเตอร์ล่าสุดเพื่อยืนยันการออกจากหอพัก</p>
                        <p>มิเตอร์ของหอพัก</p>
                        <div class="divform">
                            <form name="formmeter" id="formmeter" action="" method="" onsubmit="return false">

                                <div class="form-group row">
                                    <label class="col-sm-2 col-form-label">เลขมิเตอร์ไฟฟ้าก่อนหน้า </label>
                                    <div class="col-sm-10">
                                        <p id="meterbefor"></p>
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label class="col-sm-2 col-form-label">เลขมิเตอร์ปัจจุบัน</label>
                                    <div class="col-sm-10">
                                        <input required="required" type="number" min="1" class="form-control" id="nowmeter"
                                            placeholder="เลขมิเตอร์ปัจจุบัน">
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label class="col-sm-2 col-form-label">เลขมิเตอร์น้ำก่อนหน้า </label>
                                    <div class="col-sm-10">
                                        <p id="waterbefor"></p>
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label class="col-sm-2 col-form-label">เลขมิเตอร์น้ำปัจจุบัน</label>
                                    <div class="col-sm-10">
                                        <input required="required" type="number" min="1" class="form-control" id="nowwater"
                                            placeholder="เลขมิเตอร์น้ำปัจจุบัน">
                                    </div>
                                </div>

                                <div class="form-group row">
                                    <div class="col-sm-10">
                                        <button type="submit" class="btn btn-primary">ยืนยันการออกจากหอพัก</button>
                                    </div>
                                </div>
                            </form>
                            <div id="as">

                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>

    </div>



    <script src="https://cdn.anychart.com/releases/8.0.0/js/anychart-base.min.js"></script>
    <script src="https://canvasjs.com/assets/script/jquery-1.11.1.min.js"></script>
    <script src="https://canvasjs.com/assets/script/jquery-ui.1.11.2.min.js"></script>
    <script src="https://canvasjs.com/assets/script/jquery.canvasjs.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.js" integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
        crossorigin="anonymous"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script>

        //ข้อมูลห้อง

        $(document).ready(function () {
            var url_string = window.location.href
            var url = new URL(url_string);
            let roomNumber = "{{roomNumber}}"
            let BuildingName = "{{BuildingName}}"
            let contract = "{{room}}"
            document.getElementById("nameR").innerHTML = roomNumber;
            document.getElementById("nameB").innerHTML = BuildingName;
            var ourRequest = new XMLHttpRequest();
            var tablePos = document.getElementById('tablePos')
            var htmlString = ''
            var Choice = ''


            // get ข้อมูลทั้งตึกมา
            var ourRequest = new XMLHttpRequest();
            ourRequest.open('GET', 'https://electricitymeter.herokuapp.com/getUser/' + BuildingName)
            ourRequest.onload = function () {
                var ourData = JSON.parse(ourRequest.responseText);
                console.log(ourData)
                renderHTML(ourData);
                makeClick(ourData);
                _dataNowmeter = ourData
                console.log('sss',_dataNowmeter)
                console.log('sss',ourData)


            }
            ourRequest.send();
            getmeterbuilds()
            function getmeterbuilds() {

                var Request = new XMLHttpRequest();
                Request.open('GET', 'https://electricitymeter.herokuapp.com/getmeterbuilds/' + BuildingName)
                Request.onload = function () {
                    var Datameterbuilds = JSON.parse(Request.responseText);
                    console.log('datametebuildsggggggg', Datameterbuilds)
                    rendermeter(Datameterbuilds)

                    return false;
                }
                Request.send();
            }
            getunitmetere()
            function getunitmetere() {
                var now = new Date()
                //  console.log("Current Time is: " + now);
                var currentYear = now.getFullYear()
                //   console.log("Current year is: " + currentYear);
                var month = (now.getMonth() + 1)
                //   console.log("Current month is: " + month);

                // document.getElementById("start").innerHTML = currentYear
                if (month == 1) {

                    // document.getElementById("ShowMonth").innerHTML = 'มกราคม'
                    month = '0' + month
                } else if (month == 2) {
                    //  document.getElementById("ShowMonth").innerHTML = 'กุมภาพันธ์'
                    month = '0' + month

                } else if (month == 3) {
                    //    document.getElementById("ShowMonth").innerHTML = 'มีนาคม'
                    month = '0' + month
                } else if (month == 4) {
                    //   document.getElementById("ShowMonth").innerHTML = 'เมษายน'
                    month = '0' + month
                } else if (month == 5) {
                    //  document.getElementById("ShowMonth").innerHTML = 'พฤษภาคม'
                    month = '0' + month
                } else if (month == 6) {
                    //    document.getElementById("ShowMonth").innerHTML = 'มิถุนายน'
                    month = '0' + month
                } else if (month == 7) {
                    //    document.getElementById("ShowMonth").innerHTML = 'กรกฎาคม'
                    month = '0' + month
                } else if (month == 8) {
                    //    document.getElementById("ShowMonth").innerHTML = 'สิงหาคม'
                    month = '0' + month
                } else if (month == 9) {
                    //      document.getElementById("ShowMonth").innerHTML = 'กันยายน'
                    month = '0' + month
                } else if (month == 10) {
                    //     document.getElementById("ShowMonth").innerHTML = 'ตุลาคม '
                } else if (month == 11) {
                    //      document.getElementById("ShowMonth").innerHTML = 'พฤศจิกายน'
                } else if (month == 12) {
                    //      document.getElementById("ShowMonth").innerHTML = 'ธันวาคม'
                }

                if (month == "01") {

                    var beformont = 12
                    var beforyear = currentYear - 1
                    var befordatemeter = beforyear + "-" + beformont
                    befordatemeter = "" + befordatemeter
                } else {

                    var beformont = "0" + (parseInt(month) - 1)
                    var beforyear = currentYear
                    var befordatemeter = beforyear + "-" + beformont
                    befordatemeter = "" + befordatemeter
                }


                datemeter = currentYear + "-" + month
                //    console.log('ddd')
                //   console.log(datemeter)
                //    console.log('ddd')
                //   document.getElementById("ShowYear").innerHTML = currentYear
                datemeter = "" + datemeter
                //render จดมิเตอร์
                //sear data building 
                //เช็คมิเตอร์ก่อนหน้า


                var databefor
                var getdata = []
                getdata.push(BuildingName)
                getdata.push(datemeter)
                getdata.push(befordatemeter)
                console.log('data1', getdata)

                var Request1 = new XMLHttpRequest();
                Request1.open('GET', 'https://electricitymeter.herokuapp.com/getmeter/' + getdata)
                Request1.onload = function () {
                    var Datameterunit = JSON.parse(Request1.responseText);
                    //   console.log('datanow_', Datameterunit)

                    _dataNow = Datameterunit
                    console.log('datanowgg_', _dataNow)
                    var Request = new XMLHttpRequest();
                    Request.open('GET', 'https://electricitymeter.herokuapp.com/getmeterbefor/' + getdata)
                    Request.onload = function () {
                        var Datameterbefor = JSON.parse(Request.responseText);
                        console.log('databefor_', Datameterbefor)

                        renderPostUnitMeter(Datameterunit, Datameterbefor)


                        return false;
                    }


                    Request.send();
                    return false;
                }
                Request1.send();


            }
            validDate()
            // set date ไม่ให้กรอกวันข้างหน้า
            function validDate() {
                var today = new Date().toISOString().split('T')[0];
                var everyday = new Date().toISOString()
                var nextWeekDate = new Date(new Date().getTime() + 6 * 24 * 60 * 60 * 1000).toISOString().split('T')[0]
                document.getElementsByName("contract")[0].setAttribute('min', everyday);
                document.getElementsByName("contract")[0].setAttribute('max', today)
            }
            //เช็คข้อความบัตรประชาชนกับเบอร์โทรศัพท์
            function autoTab2(obj, typeCheck) {
                if (typeCheck == 1) {
                    var pattern = new String("_-____-_____-_-__"); // กำหนดรูปแบบในนี้
                    var pattern_ex = new String("-"); // กำหนดสัญลักษณ์หรือเครื่องหมายที่ใช้แบ่งในนี้     
                } else {
                    var pattern = new String("__-____-____"); // กำหนดรูปแบบในนี้
                    var pattern_ex = new String("-"); // กำหนดสัญลักษณ์หรือเครื่องหมายที่ใช้แบ่งในนี้                 
                }
                var returnText = new String("");
                var obj_l = obj.value.length;
                var obj_l2 = obj_l - 1;
                for (i = 0; i < pattern.length; i++) {
                    if (obj_l2 == i && pattern.charAt(i + 1) == pattern_ex) {
                        returnText += obj.value + pattern_ex;
                        obj.value = returnText;
                    }
                }
                if (obj_l >= pattern.length) {
                    obj.value = obj.value.substr(0, pattern.length);
                }
            }

            // เมื่อเกิดเหตุการ submit form

            // แทรกโค้ต jquery

            // แทรกโค้ต jquery



            // รูปแบบวันที่ที่ได้จะเป็น 2009-08-16



            $('#form').submit(function () {
                var contract = document.getElementById('contract').value
                var rentroom = document.getElementById('rentroom').value
                postdata(BuildingName, roomNumber, rentroom)
                console.log('sss2', contract)
                console.log(BuildingName)
                console.log(roomNumber)
                console.log(rentroom)
                var url = "https://electricitymeter.herokuapp.com/postcontract";
                var xhr = new XMLHttpRequest();
                xhr.open("POST", url, true);
                xhr.setRequestHeader("Content-Type", "application/json");
                xhr.onreadystatechange = function () {
                    if (xhr.readyState === 4 && xhr.status === 200) {
                        console.log('res is', xhr.responseText)
                        // if success go login page
                        alert('success')
                        window.location.reload(false);

                    } else {
                        //alert('can not create user! Pls try again.')
                    }
                };

                var data = JSON.stringify({ contract: '' + contract, BuildingName: BuildingName, roomNumber: roomNumber, rentroom: rentroom });
                xhr.send(data);
                return false;

            });
            function postdata(BuildingName, roomNumber, rentroom) {
                //  alert(rentroom)
                var url = "https://electricitymeter.herokuapp.com/postrentroom";
                var xhr = new XMLHttpRequest();
                xhr.open("POST", url, true);
                xhr.setRequestHeader("Content-Type", "application/json");
                xhr.onreadystatechange = function () {
                    if (xhr.readyState === 4 && xhr.status === 200) {
                        console.log('res is', xhr.responseText)
                        // if success go login page
                        // alert('success')
                        //  window.location.reload(false);

                    } else {
                        //alert('can not create user! Pls try again.')
                    }
                };

                var data = JSON.stringify({ BuildingName: BuildingName, roomNumber: roomNumber, rentroom: rentroom });
                xhr.send(data);
                return false;
            }
            $('#personID').on('input', function (e) {
                var obj = document.getElementById('personID').value


                if (document.getElementById('personID').value == "" || obj.length != 13) {
                    document.getElementById("validationText").style.color = "red";
                    document.getElementById("validationText").innerHTML = 'กรุณากรอกข้อมูลให้ครบทั้ง 13 ตัว กรอกเฉพาะตัวเลข ';
                } else {
                    document.getElementById("validationText").innerHTML = "";
                }
            })
            $('#phoneNumber').on('input', function (e) {
                var objp = document.getElementById('phoneNumber').value
                console.log(objp)

                if (document.getElementById('phoneNumber').value == "" || objp.length != 10) {
                    document.getElementById("validationTextphone").style.color = "red";
                    document.getElementById("validationTextphone").innerHTML = 'กรุณากรอกข้อมูลให้ครบทั้ง 10 ตัว กรอกเฉพาะตัวเลข ';
                } else {
                    document.getElementById("validationTextphone").innerHTML = "";
                }
            })
            $('#form1').submit(function () {

                if (document.getElementById('personID').value == "" || document.getElementById('personID').value.length != 13) {
                    alert('PLEASE INPUT Person ID');

                    return false;
                } else if (document.getElementById('firstName').value == "") {
                    alert('PLEASE INPUT FirstNmae');
                    return false;
                } else if (document.getElementById('lastName').value == "") {
                    alert('PLEASE INPUT LastNmae');
                    return false;
                } else if (document.getElementById('birthday').value == "") {
                    alert('PLEASE INPUT birthday');
                    return false;
                } else if (document.getElementById('address').value == "") {
                    alert('PLEASE INPUT address');
                    return false;
                } else if (document.getElementById('phoneNumber').value == "") {
                    alert('PLEASE INPUT phoneNumber');
                    return false;
                }
                var personID = document.getElementById("personID").value;
                var firstName = document.getElementById("firstName").value;
                var lastName = document.getElementById("lastName").value;
                var birthday = document.getElementById("birthday").value;
                var address = document.getElementById("address").value;
                var phoneNumber = document.getElementById("phoneNumber").value;
                var License = document.getElementById("License").value;

                var newUser = {
                    personID, firstName, lastName, birthday, address, phoneNumber, License, BuildingName, roomNumber
                }

                console.log('ss', newUser)
                postData(newUser)

                return false;
            })

            function postData(newUser) {

                var Choice = document.getElementById('plus').innerHTML
                if (Choice == 'เพิ่มข้อมูล') {
                    console.log(newUser)

                    console.log('pppp')
                    var url = "https://electricitymeter.herokuapp.com/postUser";
                    var xhr = new XMLHttpRequest();
                    xhr.open("POST", url, true);
                    xhr.setRequestHeader("Content-Type", "application/json");
                    xhr.onreadystatechange = function () {
                        if (xhr.readyState === 4 && xhr.status === 200) {
                            if (xhr.responseText == "not mat") {
                                alert('เลขบัตรประชานชนหรือเบอร์โทรศัพท์ซ้ำ')
                                return false;
                            } else if (xhr.responseText == "บันทึกสำเร็จ") {
                                console.log('res is', xhr.responseText)
                                // if success go login page
                                alert('create user Successful ', xhr.responseText)
                                console.log(' success', xhr.responseText)
                                window.location.reload(true);
                            }
                            //  window.location.href = 'http://127.0.0.1:5500/somelogin.html';

                        } else if (xhr.status === 400 && xhr.responseText != "บันทึกสำเร็จ") {
                            //alert('can not create user! Pls try again.')
                            alert('not success ', xhr.responseText)
                            console.log('not success', xhr.responseText)
                        }
                    };
                    var data = JSON.stringify({
                        personID: "" + newUser.personID, firstName: newUser.firstName, lastName: newUser.lastName, birthday: newUser.birthday, address: newUser.address, phoneNumber: newUser.phoneNumber, License: newUser.License, BuildingName: newUser.BuildingName, roomNumber: newUser.roomNumber

                    });
                    xhr.send(data);
                } else if (Choice == 'เเกไขข้อมูล') {
                    postchangeuser(newUser)
                    console.log(newUser)
                    var phoneuser
                    var personiduser
                    console.log('newUser', _phoneNumberuser)
                    console.log(Choice)
                    console.log('ttt')
                    var url = "https://electricitymeter.herokuapp.com/updateUser";
                    var xhr = new XMLHttpRequest();
                    xhr.open("POST", url, true);
                    xhr.setRequestHeader("Content-Type", "application/json");
                    xhr.onreadystatechange = function () {
                        if (xhr.readyState === 4 && xhr.status === 200) {
                            console.log('res is', xhr.responseText)
                            // if success go login page
                            alert('create user Successful ')
                            window.location.reload(true);
                            //  window.location.href = 'http://127.0.0.1:5500/somelogin.html';

                        } else {
                            //alert('can not create user! Pls try again.')
                        }
                    };
                    var data = JSON.stringify({
                        personID: newUser.personID, firstName: newUser.firstName, lastName: newUser.lastName, birthday: newUser.birthday, address: newUser.address, phoneNumber: newUser.phoneNumber, License: newUser.License, BuildingName: newUser.BuildingName, roomNumber: newUser.roomNumber, phoneuser: _phoneNumberuser, personiduser: _personIDuser

                    });
                    xhr.send(data);
                }
                function postchangeuser(newUser) {
                    console.log(newUser)
                    var phoneuser
                    console.log('newUser', _phoneNumberuser)
                    console.log(Choice)
                    console.log('ttt')
                    var url = "https://electricitymeter.herokuapp.com/updateUserroom";
                    var xhr = new XMLHttpRequest();
                    xhr.open("POST", url, true);
                    xhr.setRequestHeader("Content-Type", "application/json");
                    xhr.onreadystatechange = function () {
                        if (xhr.readyState === 4 && xhr.status === 200) {
                            console.log('res is', xhr.responseText)
                            // if success go login page
                            alert('create user Successful ')
                            window.location.reload(true);
                            //  window.location.href = 'http://127.0.0.1:5500/somelogin.html';

                        } else {
                            //alert('can not create user! Pls try again.')
                        }
                    };
                    var data = JSON.stringify({
                        personID: newUser.personID, firstName: newUser.firstName, lastName: newUser.lastName, birthday: newUser.birthday, address: newUser.address, phoneNumber: newUser.phoneNumber, License: newUser.License, BuildingName: newUser.BuildingName, roomNumber: newUser.roomNumber, phoneuser: _phoneNumberuser

                    });
                    xhr.send(data);
                }
            }


            function renderHTML(ourData) {
                for (let i = 0; i < ourData[0].floor.length; i++) {
                    for (let j = 0; j < ourData[0].floor[i].room.length; j++) {
                        if (roomNumber == ourData[0].floor[i].room[j].roomNumber) {

                            document.getElementById("showcontract").innerHTML = ourData[0].floor[i].room[j].contract;
                            document.getElementById("showrentroom").innerHTML = ourData[0].floor[i].room[j].rentroom;
                            console.log('ytyt', ourData[0].floor[i].room[j].user.length)
                            for (let k = 0; k < ourData[0].floor[i].room[j].user.length; k++) {
                                htmlString += '<tr><th scope="row">' + (k + 1) + '</th><td>' + ourData[0].floor[i].room[j].user[k].personID + '</td><td>'
                                    + ourData[0].floor[i].room[j].user[k].firstName + '</td><td>' + ourData[0].floor[i].room[j].user[k].lastName + '</td><td>' + ourData[0].floor[i].room[j].user[k].address + '</td><td>' + ourData[0].floor[i].room[j].user[k].phoneNumber + '</td><td>' + ourData[0].floor[i].room[j].user[k].License + '</td><td>'
                                    + '<div id="img_container"><img   class="edit ' + (k) + '" width="20px" height="20px" src="https://png.icons8.com/windows/1600/new-by-copy.png" ></div></td><td>'
                                    + '<div id="img_container"><img class="remove ' + (k) + '" width="20px" height="20px" src="https://cdn0.iconfinder.com/data/icons/round-ui-icons/512/close_red.png"></div></td></tr>'
                            }

                        }
                    }
                }
                tablePos.insertAdjacentHTML('beforeend', htmlString);
            }
            function makeClick(ourData) {
                $('.edit').click(function (e) {
                    //   alert('edit ' + e.target.classList[1])
                    let count = e.target.classList[1]
                    for (let i = 0; i < ourData[0].floor.length; i++) {
                        for (let j = 0; j < ourData[0].floor[i].room.length; j++) {
                            if (roomNumber == ourData[0].floor[i].room[j].roomNumber) {
                                document.getElementById("personID").value = ourData[0].floor[i].room[j].user[count].personID;
                                document.getElementById("firstName").value = ourData[0].floor[i].room[j].user[count].firstName;
                                document.getElementById("lastName").value = ourData[0].floor[i].room[j].user[count].lastName;
                                document.getElementById("birthday").value = ourData[0].floor[i].room[j].user[count].birthday;
                                document.getElementById("address").value = ourData[0].floor[i].room[j].user[count].address;
                                document.getElementById("phoneNumber").value = ourData[0].floor[i].room[j].user[count].phoneNumber;
                                document.getElementById("License").value = ourData[0].floor[i].room[j].user[count].License;
                                document.getElementById("plus").innerHTML = 'เเกไขข้อมูล'
                                _phoneNumberuser = ourData[0].floor[i].room[j].user[count].phoneNumber
                                _personIDuser = ourData[0].floor[i].room[j].user[count].personID

                            }
                        }
                    }

                })

                $('.remove').click(function (e) {
                    alert('remove ' + e.target.classList[1])
                    var r = confirm("Do you want to delete the person?");
                    if (r == true) {

                        let count = e.target.classList[1]
                        for (let i = 0; i < ourData[0].floor.length; i++) {
                            for (let j = 0; j < ourData[0].floor[i].room.length; j++) {
                                if (roomNumber == ourData[0].floor[i].room[j].roomNumber) {
                                    if (ourData[0].floor[i].room[j].user.length <= 1) {
                                        alert('Can not delete user')
                                        return false
                                    }


                                    var personID = ourData[0].floor[i].room[j].user[count].personID;
                                    var firstName = ourData[0].floor[i].room[j].user[count].firstName;
                                    var lastName = ourData[0].floor[i].room[j].user[count].lastName;
                                    var birthday = ourData[0].floor[i].room[j].user[count].birthday;
                                    var address = ourData[0].floor[i].room[j].user[count].address;
                                    var phoneNumber = ourData[0].floor[i].room[j].user[count].phoneNumber;
                                    var License = ourData[0].floor[i].room[j].user[count].License;
                                }
                            }
                        }
                        var newUser = {
                            personID, firstName, lastName, birthday, address, phoneNumber, License, BuildingName, roomNumber
                        }
                        var url = "https://electricitymeter.herokuapp.com/deleteUser";
                        var xhr = new XMLHttpRequest();
                        xhr.open("POST", url, true);
                        xhr.setRequestHeader("Content-Type", "application/json");
                        xhr.onreadystatechange = function () {
                            if (xhr.readyState === 4 && xhr.status === 200) {
                                console.log('res is', xhr.responseText)
                                // if success go login page
                                //   alert('Delete ser Successful ')
                                window.location.reload(true);
                                //  window.location.href = 'http://127.0.0.1:5500/somelogin.html';

                            } else {
                                //alert('can not create user! Pls try again.')
                            }
                        };
                        var data = JSON.stringify({
                            personID: newUser.personID, firstName: newUser.firstName, lastName: newUser.lastName, birthday: newUser.birthday, address: newUser.address, phoneNumber: newUser.phoneNumber, License: newUser.License, BuildingName: newUser.BuildingName, roomNumber: newUser.roomNumber

                        });
                        xhr.send(data);

                        /*  {{!-- var url = "http://localhost:3000/postUserdelete";
                          var xhr = new XMLHttpRequest();
                          xhr.open("POST", url, true);
                          xhr.setRequestHeader("Content-Type", "application/json");
                          xhr.onreadystatechange = function () {
                              if (xhr.readyState === 4 && xhr.status === 200) {
                                  console.log('res is', xhr.responseText)
                                  // if success go login page
                                  //   alert('Delete ser Successful ')
                                  window.location.reload(true);
                                  //  window.location.href = 'http://127.0.0.1:5500/somelogin.html';
  
                              } else {
                                  //alert('can not create user! Pls try again.')
                              }
                          };
                          var datauser = JSON.stringify({
                              personID: newUser.personID, firstName: newUser.firstName, lastName: newUser.lastName, birthday: newUser.birthday, address: newUser.address, phoneNumber: newUser.phoneNumber, License: newUser.License, BuildingName: newUser.BuildingName, roomNumber: newUser.roomNumber
  
                          });
                          xhr.send(datauser);
                          console.log('ggg')
                          console.log(datauser)
                          console.log('ggg') --}}*/
                    } else {
                        //   alert('no')
                    }
                })
            }
            //==============================ย้ายออก===================
            function rendermeter(Datameterbuilds) {
                let countroom = 0
                let htmlStringmeterbuilds = ""
                console.log('datametebuilds', Datameterbuilds)
                for (let l = 0; l < Datameterbuilds.length; l++) {
                    for (let i = 0; i < Datameterbuilds[l].floormeter.length; i++) {

                        for (let j = 0; j < Datameterbuilds[l].floormeter[i].roommeter.length; j++) {
                            console.log('tester',_dataNowmeter[0].BuildingName)
                            if (Datameterbuilds[l].floormeter[i].roommeter[j].meterstatus == "ค้างชำระ" && Datameterbuilds[l].floormeter[i].roommeter[j].waterstatus == "ค้างชำระ" && Datameterbuilds[l].floormeter[i].roommeter[j].roomNumbermeter == roomNumber && Datameterbuilds[l].floormeter[i].roommeter[j].statusprint != "เคยพริ้น" ) {
                              //console.log('testdata',_dataNowmeter[l].floor[i].room[j].user.length)
                                countroom = countroom + 1

                                htmlStringmeterbuilds +=
                                    ' <div  class="row justify-content-md-center">'
                                    + ' <div class="divform">'
                                    + '  <div class="row justify-content-center">'
                                    + '   <div class="col-5 col-sm-2"><br>'
                                    + '       <p class="h4">ค้างชำระประจำเดือน</p>'
                                    + '   </div>'
                                    + '   <div class="col-2 col-sm-2"><br>'
                                    + '      <p id="Updatefloor">' + (Datameterbuilds[l].datemeter) + '</p>'
                                    + '   </div>'
                                    + '  </div>'
                                    + '   <table class="table table-bordered" >'
                                    + '  <thead>'
                                    + '     <tr>'
                                    + '     </tr>'
                                    + '  </thead>'
                            }
                        }
                    }
                }
                for (let l = 0; l < Datameterbuilds.length; l++) {
                    for (let i = 0; i < Datameterbuilds[l].floormeter.length; i++) {

                        for (let j = 0; j < Datameterbuilds[l].floormeter[i].roommeter.length; j++) {
                            if (Datameterbuilds[l].floormeter[i].roommeter[j].meterstatus == "ค้างชำระ" && Datameterbuilds[l].floormeter[i].roommeter[j].waterstatus == "ค้างชำระ" && Datameterbuilds[l].floormeter[i].roommeter[j].roomNumbermeter == roomNumber && Datameterbuilds[l].floormeter[i].roommeter[j].statusprint != "เคยพริ้น") {
                            }
                        }
                        htmlStringmeterbuilds += '</table></div></div>'
                    }

                }

                document.getElementById("bill").innerHTML = htmlStringmeterbuilds

                $('#formmeter').submit(function () {
                    var nowmeter = document.getElementById('nowmeter').value
                    var nowwater = document.getElementById('nowwater').value
                    var rentroom = document.getElementById("showrentroom").value
                    var countprint = 0
                    console.log('rentroommmm', _dataNow)
                    let htmlStringmeterprint = ""
                    var r = confirm("Do you want to move out of the hostel?");
                    if (r == true) {
                        if (countroom == 0) {
                            console.log('hh', Datameterbuilds)
                            console.log('hh', roomNumber)
                            for (let l = 0; l < _dataNow.length; l++) {
                                for (let i = 0; i < _dataNow[l].floormeter.length; i++) {
                                    for (let j = 0; j < _dataNow[l].floormeter[i].roommeter.length; j++) {
                                        if (roomNumber == _dataNow[l].floormeter[i].roommeter[j].roomNumbermeter) {
                                            if (_dataNowmeter[l].floor[i].room[j].rentroom == "" || _dataNowmeter[l].floor[i].room[j].rentroom == undefined) {
                                                alert('please input rentroom')
                                                return false
                                            }
                                        }
                                    }
                                }
                            }
                            /*
                            if (_dataNowmeter[0] == "rentunit") {

                                for (let l = 0; l < _dataNow.length; l++) {
                                    for (let i = 0; i < _dataNow[l].floormeter.length; i++) {
                                        for (let j = 0; j < _dataNow[l].floormeter[i].roommeter.length; j++) {
                                            if (roomNumber == _dataNow[l].floormeter[i].roommeter[j].roomNumbermeter) {
                                                if (_dataNowmeter[l].floor[i].room[j].rentroom == "" || _dataNowmeter[l].floor[i].room[j].rentroom == undefined) {
                                                    alert('please input rentroom')
                                                    return false
                                                }
                                                countprint = countprint + countprint
                                                for (let a = 0; a < 2; a++) {

                                                    htmlStringmeterprint +=
                                                        ' <div class="container">'
                                                        + '<div class="col-10" >'
                                                        + ' <br>'
                                                        + '         <div class="row">'
                                                        + '           <div class="col-3">'
                                                        + '            </div>'
                                                        + '            <div class="col-5">'
                                                        + '                <h2 style="text-align: center;"> ใบเเจ้งหนี้ (Invoice)</h2>'
                                                        + '            </div>'
                                                        + '<br>'
                                                        + '       </div>'
                                                        + '       <div class="row">'
                                                        + '            <div class="col-7">'
                                                        + '                <h3>ชื่อหอพัก..........' + _dataNow[l].buildingnamemeter + ' </h3>'
                                                        + '            </div>'
                                                        + '         </div>'
                                                        + '       <div class="row">'
                                                        + '            <div class="col-7">'
                                                        + '                <h3>เลขที่ห้องพัก....' + _dataNow[l].floormeter[i].roommeter[j].roomNumbermeter + ' </h3>'
                                                        + '            </div>'
                                                        + '         </div>'
                                                        + '          <div class="row">'
                                                        + '             <div class="col-8">'
                                                        + '                 <h3>ประจำเดือน......' + _dataNow[l].datemeter + '</h3>'
                                                        + '              </div>'
                                                        + '          </div>'
                                                        + '           <hr style="border: 1px solid black;">'
                                                        + '              <table class="table table-striped class=" table-primary "">'
                                                        + '                    <thead>'
                                                        + '                    <tr>'
                                                        + '                       <th scope="col-2"></th>'
                                                        + '                      <th scope="col-2">เลขมิเตอร์ก่อนหน้า</th>'
                                                        + '                       <th scope="col-1">เลขมิเตอร์ปัจจุบัน</th>'
                                                        + '                       <th scope="col-2">จำนวนที่ใช้</th>'
                                                        + '                       <th scope="col-2">ราคาต่อหน่วย/บาท</th>'
                                                        + '                       <th scope="col-2">จำนวนเงินที่ต้องจ่าย</th>'
                                                        + '                   </tr>'
                                                        + '               </thead>'
                                                        + '                <tbody>'
                                                        + '                     <tr>'
                                                        + '                         <td>ค่าเช่า</td>'
                                                        + '                         <td></td>'
                                                        + '                          <td></td>'
                                                        + '                           <td></td>'
                                                        + '                          <td></td>'
                                                        + '                            <td style="text-align: right;" >' + _dataNowmeter[l].floor[i].room[j].rentroom + '</td>'
                                                        + '                         </tr>'
                                                        + '                   <tr>'
                                                        + '                       <td>ค่าไฟฟ้า</td>'
                                                        + '                       <td style="text-align: right;">' + _dataNow[l].floormeter[i].roommeter[j].usemeter + '</td>'
                                                        + '                        <td style="text-align: right;">' + nowmeter + '</td>'
                                                        + '                        <td style="text-align: right;">' + (nowmeter - _dataNow[l].floormeter[i].roommeter[j].usemeter) + '</td>'
                                                        + '                        <td style="text-align: right;">' + _dataNowmeter[l].UnitMeter + '</td>'
                                                        + '                        <td style="text-align: right;">' + ((nowmeter - _dataNow[l].floormeter[i].roommeter[j].usemeter) * _dataNowmeter[l].UnitMeter) + '</td>'
                                                        + '                     </tr>'
                                                        + '                   <tr>'
                                                        + '                       <td>ค่าน้ำ</td>'
                                                        + '                       <td style="text-align:right;">' + _dataNow[l].floormeter[i].roommeter[j].usewater + '</td>'
                                                        + '                        <td style="text-align:right;">' + nowwater + '</td>'
                                                        + '                        <td style="text-align: right;">' + (nowwater - _dataNow[l].floormeter[i].roommeter[j].usewater) + '</td>'
                                                        + '                        <td style="text-align: right;">' + _dataNowmeter[l].plicewater + '</td>'
                                                        + '                        <td style="text-align: right;">' + ((nowwater - _dataNow[l].floormeter[i].roommeter[j].usewater) * _dataNowmeter[l].plicewater) + '</td>'
                                                        + '                     </tr>'
                                                        + '                   </tbody>'
                                                        + '                             </table>'
                                                        + '                <hr style="border: 1px solid black;">'
                                                        + '                    <div class="row">'
                                                        + '                        <div class="col-7">'
                                                        + '<br>'
                                                        + '                           <h4>รวมทั้งสิ้น ' + ((_dataNowmeter[l].floor[i].room[j].rentroom) + (((nowmeter - _dataNow[l].floormeter[i].roommeter[j].usemeter) * _dataNowmeter[l].UnitMeter)) + (((nowwater - _dataNow[l].floormeter[i].roommeter[j].usewater) * _dataNowmeter[l].plicewater))) + ' บาท </h4>'
                                                        + '                        </div>'
                                                        + '                      </div>'
                                                    htmlStringmeterprint += ' </div>'
                                                        + '<br>'
                                                    htmlStringmeterprint += ' <hr style="border: 1px solid black;">'
                                                    htmlStringmeterprint += '<br>'
                                                }

                                            }

                                        }
                                    }
                                }
                            } else {

                                for (let l = 0; l < _dataNow.length; l++) {
                                    for (let i = 0; i < _dataNow[l].floormeter.length; i++) {
                                        for (let j = 0; j < _dataNow[l].floormeter[i].roommeter.length; j++) {
                                            if (roomNumber == _dataNow[l].floormeter[i].roommeter[j].roomNumbermeter) {
                                                if (_dataNowmeter[l].floor[i].room[j].rentroom == "" || _dataNowmeter[l].floor[i].room[j].rentroom == undefined) {
                                                    alert('please input rentroom')
                                                    return false
                                                }
                                                countprint = countprint + countprint
                                                for (let a = 0; a < 2; a++) {

                                                    htmlStringmeterprint +=
                                                        ' <div class="container">'
                                                        + '<div class="col-10" >'
                                                        + ' <br>'
                                                        + '         <div class="row">'
                                                        + '           <div class="col-3">'
                                                        + '            </div>'
                                                        + '            <div class="col-5">'
                                                        + '                <h2 style="text-align: center;"> ใบเเจ้งหนี้ (Invoice)</h2>'
                                                        + '            </div>'
                                                        + '<br>'
                                                        + '       </div>'
                                                        + '       <div class="row">'
                                                        + '            <div class="col-7">'
                                                        + '                <h3>ชื่อหอพัก..........' + _dataNow[l].buildingnamemeter + ' </h3>'
                                                        + '            </div>'
                                                        + '         </div>'
                                                        + '       <div class="row">'
                                                        + '            <div class="col-7">'
                                                        + '                <h3>เลขที่ห้องพัก....' + _dataNow[l].floormeter[i].roommeter[j].roomNumbermeter + ' </h3>'
                                                        + '            </div>'
                                                        + '         </div>'
                                                        + '          <div class="row">'
                                                        + '             <div class="col-8">'
                                                        + '                 <h3>ประจำเดือน......' + _dataNow[l].datemeter + '</h3>'
                                                        + '              </div>'
                                                        + '          </div>'
                                                        + '           <hr style="border: 1px solid black;">'
                                                        + '              <table class="table table-striped class=" table-primary "">'
                                                        + '                    <thead>'
                                                        + '                    <tr>'
                                                        + '                       <th scope="col-2"></th>'
                                                        + '                      <th scope="col-2">เลขมิเตอร์ก่อนหน้า</th>'
                                                        + '                       <th scope="col-1">เลขมิเตอร์ปัจจุบัน</th>'
                                                        + '                       <th scope="col-2">จำนวนที่ใช้</th>'
                                                        + '                       <th scope="col-2">ราคาต่อหน่วย/บาท</th>'
                                                        + '                       <th scope="col-2">จำนวนเงินที่ต้องจ่าย</th>'
                                                        + '                   </tr>'
                                                        + '               </thead>'
                                                        + '                <tbody>'
                                                        + '                     <tr>'
                                                        + '                         <td>ค่าเช่า</td>'
                                                        + '                         <td></td>'
                                                        + '                          <td></td>'
                                                        + '                           <td></td>'
                                                        + '                          <td></td>'
                                                        + '                            <td style="text-align: right;">' + _dataNowmeter[l].floor[i].room[j].rentroom + '</td>'
                                                        + '                         </tr>'
                                                        + '                   <tr>'
                                                        + '                       <td>ค่าไฟฟ้า</td>'
                                                        + '                       <td style="text-align:right;">' + _dataNow[l].floormeter[i].roommeter[j].usemeter + '</td>'
                                                        + '                        <td style="text-align: right;">' + nowmeter + '</td>'
                                                        + '                        <td style="text-align: right;">' + (nowmeter - _dataNow[l].floormeter[i].roommeter[j].usemeter) + '</td>'
                                                        + '                        <td style="text-align:right;">' + _dataNowmeter[l].UnitMeter + '</td>'
                                                        + '                        <td style="text-align:right;">' + ((nowmeter - _dataNow[l].floormeter[i].roommeter[j].usemeter) * _dataNowmeter[l].UnitMeter) + '</td>'
                                                        + '                     </tr>'
                                                        + '                   <tr>'
                                                        + '                       <td>ค่าน้ำ</td>'
                                                        + '                       <td></td>'
                                                        + '                        <td></td>'
                                                        + '                        <td></td>'
                                                        + '                        <td></td>'
                                                        + '                        <td style="text-align: right;">' + (_dataNowmeter[l].plicewater) + '</td>'
                                                        + '                     </tr>'
                                                        + '                   </tbody>'
                                                        + '                             </table>'
                                                        + '                <hr style="border: 1px solid black;">'
                                                        + '                    <div class="row">'
                                                        + '                        <div class="col-7">'
                                                        + '<br>'
                                                        + '                           <h4>รวมทั้งสิ้น ' + ((_dataNowmeter[l].floor[i].room[j].rentroom) + (((nowmeter - _dataNow[l].floormeter[i].roommeter[j].usemeter) * _dataNowmeter[l].UnitMeter)) + (_dataNowmeter[l].plicewater)) + ' บาท </h4>'
                                                        + '                        </div>'
                                                        + '                      </div>'
                                                    htmlStringmeterprint += ' </div>'
                                                        + '<br>'
                                                    htmlStringmeterprint += ' <hr style="border: 1px solid black;">'
                                                    htmlStringmeterprint += '<br>'
                                                }

                                            }

                                        }
                                    }
                                }
                            } */
                            //  document.getElementById("as").innerHTML = htmlStringmeterprint
                            console.log('sss',_dataNowmeter[0].methodwater)
                            console.log('sss',_dataNowmeter)
                            var Datameterbuilds
                            var methodwater
                             var url = "https://electricitymeter.herokuapp.com/outroom";
                            var xhr = new XMLHttpRequest();
                            xhr.open("POST", url, true);
                            xhr.setRequestHeader("Content-Type", "application/json");
                            xhr.onreadystatechange = function () {
                                if (xhr.readyState === 4 && xhr.status === 200) {
                                    console.log('res is', xhr.responseText)
                                    // if success go login page
                                    //   alert('Delete ser Successful ')
                                    window.open('https://electricitymeter.herokuapp.com/printout', '_blank');
                                    window.location.reload(true);
                                    //  window.location.href = 'http://127.0.0.1:5500/somelogin.html';

                                } else {
                                    //alert('can not create user! Pls try again.')
                                }
                            };
                            var data = JSON.stringify({
                                roomNumber: roomNumber, BuildingName: BuildingName, nowmeter: nowmeter, nowwater: nowwater,
                                Datameterbuilds:_dataNow,methodwater:_dataNowmeter[0].methodwater
                            });
                            xhr.send(data);
                            return false 

                            //console.log('ใบเเจ้งหนี้', htmlStringmeterprint)
                        } else {
                            alert('มีบิลค้างชำระโปรดกลับไปหน้าชำระเงิน')

                        }

                    } else {
                        alert('Thank!!')
                    }

                    return false


                });
            }
            function renderPostUnitMeter(Datameterunit, Datameterbefor) {
                console.log('gdpsss', Datameterunit.length)
                for (let i = 0; i < Datameterunit.length; i++) {
                    for (let j = 0; j < Datameterunit[0].floormeter[i].roommeter.length; j++) {
                        if (roomNumber == Datameterunit[0].floormeter[i].roommeter[j].roomNumbermeter) {
                            document.getElementById("meterbefor").innerHTML = Datameterunit[0].floormeter[i].roommeter[j].usemeter
                            document.getElementById("waterbefor").innerHTML = Datameterunit[0].floormeter[i].roommeter[j].usewater
                            console.log('ssssgdp', Datameterunit[0].floormeter[i].roommeter[j].beforusemeter)
                        }
                    }
                }
            }

        })
    </script>

    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"></script>
</body>

</html>